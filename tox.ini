; tox configuration file for running tests similar to buildbot builders.

[tox]
skip_missing_interpreters=True
toxworkdir=build/
envlist=
        {py27,py33,py34,py35}-{tests,nomodules,coverage}
        flake8,twistedchecker,apidocs,narrativedocs
skipsdist=True

[flake8]
ignore = E101,E111,E112,E113,E114,E115,E116,E121,E122,E123,E124,E125,E126,E127,E128,E129,E131,E133,E201,E202,E203,E211,E221,E222,E223,E224,E225,E226,E227,E228,E231,E241,E242,E251,E261,E262,E265,E266,E271,E272,E273,E274,E301,E302,E303,E304,E401,E402,E501,E502,E701,E702,E703,E704,E711,E712,E713,E714,E721,E731,E901,E902,W191,W291,W292,W293,W391,W503,W601,W602,W603,W604
exclude = twisted/words/xish/xpathparser.py,twisted/scripts/tap2deb.py

[testenv]
changedir={envtmpdir}
skip_install=True
deps =
     ; zope.interface is love, zope.interface is life
     zope.interface

     ; Some relatively standard dependencies that we want to have
     ; We cannot use extras here, because it is not supported on Py3
     {tests,coverage}: pyopenssl
     {tests,coverage}: service_identity
     {tests,coverage}: pycrypto

     coverage: coverage

     ; Code quality checkers
     flake8: flake8
     twistedchecker: twistedchecker

     ; Documentation
     apidocs: pydoctor
     narrativedocs: sphinx

commands =
    py27-{tests,nomodules}: python {toxinidir}/bin/trial {posargs:twisted}
    {py33,py34,py35}-{tests,nomodules}: python {toxinidir}/admin/run-python3-tests {posargs:}

    twistedchecker: twistedchecker {posargs:twisted}
    flake8: flake8 {posargs:twisted}

    apidocs: {toxinidir}/bin/admin/build-apidocs {toxinidir} apidocs
    narrativedocs: sphinx-build -aW -b html -d {toxinidir}/docs/_build {toxinidir}/docs {toxinidir}/docs/_build/

    coverage: coverage erase
    py27-coverage: coverage run --rcfile={toxinidir}/.coveragerc {toxinidir}/bin/trial --reporter=bwverbose {posargs:twisted}
    {py33,py34,py35}-coverage: coverage run --rcfile={toxinidir}/.coveragerc {toxinidir}/admin/run-python3-tests --reporter=bwverbose {posargs:}
    coverage: coverage report --rcfile={toxinidir}/.coveragerc

[testenv:twistedchecker]
basepython=python2.7
changedir={toxinidir}
[testenv:flake8]
basepython=python2.7
changedir={toxinidir}
[testenv:apidocs]
basepython=python2.7
